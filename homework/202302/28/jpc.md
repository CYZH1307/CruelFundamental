# 如何用 Redis 实现分布式锁?
Redis的SET命令的NX参数可以实现key不存在时才插入，所以可以用它来实现分布式锁。
* key不存在表示插入成功，表示加锁成功。
* key存在表示插入失败，表示加锁失败。

* 加锁用SET命令+NX实现加锁。
* 锁变量需要设置过期时间，以免客户端拿到锁之后发生异常，导致锁一直无法释放。所以需要加上PX/EX参数设置过期时间。
* 锁变量的值需要区分来自不同客户端的加锁操作，以免在释放锁的时候，出现误释放的操作。
* 解锁的时候，我们要先判断锁的 值 是否为加锁客户端，是的话，才将 锁 键删除，此操作必须是原子性的，所以要用Lua脚本执行。
* 为了保证集群环境下分布式锁的可靠性，Redis 设计了一个分布式锁算法 Redlock（红锁）。
* 红锁：让客户端和多个独立的Redis节点依次请求申请加锁，如果客户端能够和半数以上的节点成功完成加锁操作，那么我们就认为，客户端成功的获得了分布式锁，否则加锁失败。
