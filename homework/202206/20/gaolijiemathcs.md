### 如何设计reliable UDP

设计可靠的UDP

要求可靠传输代表提供可靠的交付服务，包括传输数据的无差错、不丢失、不重复并且有序。

保证了数据接收方从缓冲区读出的字节流与发送方的字节流完全一致。

UDP已经有校验机制。因此需要增加序号、确认、重传等机制来保证UDP可靠。



（1）序号：UDP原来只有源端口、目的端口、UDP长度、UDP检验和。还需要增加报文序号、确认号字段。

（2）确认机制：需要增加确认号。接收方每接收到一个报文，需要返回对这个数据包的正确接收消息，ACK消息。

（3）重传机制：

- 定时重传：如果发送端发出数据包以后，定时一个RTO，没有收到对该数据包的ACK消息，则重传。（容易误判，对延迟敏感实时性要求高的场景可以用）

- 请求重传：接收端在发送ACK的时候，携带自己的丢失报文的信息反馈，发送端依照ACK信息中的重传反馈进行数据包的重传。（适合用在带宽较大的传输，视频、文件、数据同步等等）

- 分组后用EFC进行冗余编码选择重传：发送方发送报文，EFC将报文分组，获得冗余包，一起发送。接收端有丢包，可以依靠冗余包进行EFC分组算法还原。如果还是不能还原则向发送方请求。（带宽要求充裕，时延敏感随机丢包场景可用）



拥塞控制对可靠性没有影响，但是重传会导致时延和网络压力，如果控制不好会导致网络风暴，所以发送端和接收端也要配合实现拥塞控制。

可以直接使用TCP的慢启动、拥塞避免、拥塞处理、快速恢复来进行拥塞控制。

也可以使用估算的方法，评估发送端的发送延迟，和带宽情况进行拥塞控制，控制发送端的发送速率。

实际上进行设计的时候，需要在成本、网络时延、通信质量三者之间进行平衡。



ref:https://cloud.tencent.com/developer/article/1198427