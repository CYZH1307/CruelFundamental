- ## 2022/03/06

  ### mutex的实现和局限性

  Mutex有两个基本操作Lock 和 Unlock：

  Mutex加锁:

  - 在没有锁的情况下直接加锁
  - 占用锁的进程是否正在进行，如果是，自旋等待
  - 如果在之前已经有进程在自旋，会因为获取不到 osq 锁而切换自旋方式，阻塞在本地 CPU 上而不是阻塞在 mutex lock 上
  - 自旋的时候也会判断自旋条件是否满足，
  - 当进程添加到wait_list,就会进入睡眠
  - 进程被唤醒的时候还拿不到锁就设置handoff

  Mutex解锁：

  - 没有等待者直接解锁
  - 如果有handoff标识且wait_list 上有等待者，唤醒等待者
  - 存在handoff标志，将锁交给wait_list 上的第一个等待者

  