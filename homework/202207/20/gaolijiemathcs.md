### 什么是COW（copy on write)?

什么是COW？

核心思想：如果有多个调用者同时请求相同组员（例如内存或者磁盘上的数据存储），他们会共同获取相同的指针指向相同的资源，直到某个调用者试图修改资源的内容的时候，系统才会真正的复制一份专用的副本给调用者。而其他调用者看到的最初的资源仍然保持不变，这个过程对其他调用者是透明的。做法的优点是，如果调用者没有修改该资源，就不会有副本被建立，因此多个调用者只是读取操作的时候可以共享同一份资源。

Linux系统通过这个操作减少Fork开销。

```
fork()之后，kernel把父进程中所有的内存页的权限都设为read-only，然后子进程的地址空间指向父进程。当父子进程都只读内存时，相安无事。当其中某个进程写内存时，CPU硬件检测到内存页是read-only的，于是触发页异常中断（page-fault），陷入kernel的一个中断例程。中断例程中，kernel就会把触发的异常的页复制一份，于是父子进程各自持有独立的一份。

Copy On Write技术好处是什么？

- COW技术可减少分配和复制大量资源时带来的瞬间延时。
- COW技术可减少不必要的资源分配。比如fork进程时，并不是所有的页面都需要复制，父进程的代码段和只读数据段都不被允许修改，所以无需复制。

Copy On Write技术缺点是什么？

- 如果在fork()之后，父子进程都还需要继续进行写操作，那么会产生大量的分页错误(页异常中断page-fault)，这样就得不偿失。


```



ref:https://www.cnblogs.com/Java3y/p/9884583.html