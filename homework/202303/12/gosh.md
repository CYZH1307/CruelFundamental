为什么需要四次挥手？

第一次挥手：
A->B，A向B发出释放连接请求的报文，其中FIN=1，seq=u；在A发送完之后，A的TCP客户端进入FIN-WAIT-1状态。此时A还可以收数据。
第二次挥手：
B->A，B在收到A的连接释放请求后，随即向A发送确认报文。其中ACK=1，seq=v，ack=u+1；在B发送完毕后，B的服务器端进入CLOSE_WAIT（关闭等待）状态。此时A收到这个确认后就进入FIN-WAIT-2状态，等待B发出释放连接的请求。此时B还是可以发数据的。
（如果B直接跑路，则A永远处于这个状态。TCP协议里面并没有对这个状态的处理，但Linux有，可以调整tcp_fin_timeout这个参数，设置一个超时时间）
第三次挥手：
B->A，当B已经没有要发送的数据时，B就会给A发送一个释放连接报文，其中FIN=1，ACK=1，seq=w，ack=u+1，在B发送完之后，B进入LAST-ACK状态。
第四次挥手：
A->B，当A收到B的释放连接请求时，必须对此发出确认，其中ACK=1，seq=u+1，ack=w+1；在A发送完毕后，进入到TIME-WAIT状态。B在收到A的确认之后，进入到CLOSED状态。在经过时间等待计时器设置的时间之后，A才会进入CLOSED状态。

是客户端和服务端分别释放连接的过程。各两次。
服务端收到连接释放报文时，可能还有要处理的数据，不能立刻释放连接，因此ACK和FIN分成两次发送。三次握手时，不需要做这些准备，因此这两次发送合在一起了。