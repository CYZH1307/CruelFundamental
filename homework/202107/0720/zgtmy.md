# mysql join的底层原理是什么?   

## 1.嵌套循环连接算法（Nested-Loop Join Algorithm）   

从第一张表读出满足条件的几行数据，并将这些数据每次一行的传给第二张表，第二张表根据第一张表传递过来的数据过滤，得到满足条件的数据再每次一条的传给第三张表，如此往复。   

## 2.块嵌套循环连接算法（Block Nested-Loop Join Algorithm）   

这个算法使用了缓存存储外层循环的数据，减少了内层循环的读取次数。     

通过使用缓存使内层读取外层数据的次数减少了一个数量级。     

在MySQL8.0.18之前，当没有索引可以使用时，这个算法被用作在等值连接中，在MySQL8.0.18及以后，这个算法已经不再被使用。取而代之的是hash连接。   

2.1连接缓存将会被使用，当连接的表的查询类型是ALL或者index时（没有可以使用的索引，进行了全表扫描时）或查询类型是range类型时。   

2.2 连接缓存将不会再分配，当遇到第一个查询结果是非常数级的表（参考2）。      

2.3 只有那些和连接有关的列会被存在缓存中，不是整行数据。 

2.4 每一个用到缓存的连接会分配一个缓存，所以一个查询中可能会有多个缓存。    

2.5 一个连接的缓存在连接开始前创建，在连接结束后释放。  





参考：

1.https://dev.mysql.com/doc/refman/8.0/en/nested-loop-joins.html  



2.https://dev.mysql.com/doc/internals/en/optimizer-constants-constant-tables.html  
