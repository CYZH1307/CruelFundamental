# ZooKeeper 原理
- https://segmentfault.com/a/1190000022431516

## 角色
- 领导者，负责发起投票和决议，更新系统状态
- 跟从者，接受客户端请求并回复
- 观察者，转发客户端请求给领导者，不参与选主
- 客户端，请求发起方

## 状态
- 原子传播，Zab协议
- 恢复模式，服务启动或者领导者崩溃
- 广播模式，领导者选出
- 节点的三种状态，寻找，领导和随从

## 事务顺序一致性
- 递增的事务序列号 zxid
- 64 位数字，高32位用epoch标识领导者是够改变
- 低32位用于递增计数
- 每次提议都会加上 zxid

## 读写一致性
- 一主多从
- 每个节点都保存一份数据备份，全局一致
- 分布式读写，一写多读？
- 更新请求按 zxid 排序
- 数据更新符合原子性
- 每个节点都能读到最新数据 ？

## 流程
- 客户端发送写请求给随从者
- 随从者转发给领导者
- 领导者发起投票？
- 领导者汇总，多数则确认写入 ？
- 随从者回复客户端
