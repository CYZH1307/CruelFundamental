# RedLock 分布式锁算法

## 原理
- setNX，Lua，Redisson只能用于单节点锁
- Redis 主从复制是异步的
- Redis 2.8之后支持多数连接可写
- 从节点每秒钟测试主节点，确定日志复制
- 主节点记录从节点心跳时间
- 用户配置法定N个节点，M秒确认延迟
- 如果有M个从节点，延迟小于阈值，主节点可写

## 红锁算法
- 超半数法定
- 获取当前时间戳，向所有节点设置相同的键和随机值
- 如果不超时半数设置成功，则获得分布式锁
- 锁的时间为总时间减获取时间
- 如果超时或未满半数，则释放
- 两个客户端做同样的事情，有什么冲突呢？
