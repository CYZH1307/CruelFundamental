# Kafka 如何避免丢消息

## 消息队列
- 至多一次，至少一次，正好一次
- 生产者发给Broker
- Broker消息同步和持久化
- 消费者读取消息

## 消息丢失
- 消费者获取分区主节点
- 消费者给主节点发送消息
- Broker的主节点分区将消息持久化
- 从节点拉取消息，回复ACK，同步完成
- 主节点给客户端回复ACK
- producer.type 设置同步异步
- request.required.acks = 1 表示 Leader 接受成功
- 如果主节点挂了，同时没有一个ACK的从节点，消息也会丢失
- 客户端没有收到ACK，需要重发

## TODO-消费者丢消息
