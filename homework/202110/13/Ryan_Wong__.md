# MVCC 1/4 #
1.**大前提**：数据库事务必须满足的ACID特性：  

    A-原子性：事务要么完全执行，要么完全不执行；
    
    C-一致性：事务执行后的状态只和初始态以及事务操作相关，即完全执行事务后输出与操作预期一致；
    
    I-隔离性：不同并行事务之间不可互相干扰；
    
    D-持久性：事务执行后的数据被持久化保存在数据库中，直到被下一个事务修改。
    
2.**问题**：事务并发场景会遇到的违反ACID的情况，一定会违反I-隔离性，但这是表象，本质主要是违反C-一致性。违反的类型按难以解决的程度从低到高（严重性从高到低）：  

    i.脏读：读到了未提交数据，违反AC；
  
    ii.不可重复读：一个事务两次读取同一个记录（数据的元组），结果不一致，违反C；
  
    iii.幻读：一个事务两次读取同一个表，记录条数不一致，违反C。
3.**解决**：设置隔离级别，人为规定I-隔离性的隔离层度，一般来说，隔离程度越高，C-一致性越好，但性能越差，需要根据实际场景做取舍。隔离级别从低到高：  

    i.读未提交：不加任何约束，有可能脏读。
    
    ii.读已提交：只能读到已提交的数据，解决脏读，不能解决不可重复读。一般在事务中使用读写锁实现。
    
    iii.可重复读：只能读到数据的快照版本，解决不可重复读，不能解决幻读。一般在事务中使用行锁实现。
    
    iv.序列化：最严格的约束，取消了一切事务并发，所有事务必须首尾相连来执行（如同序列一样），解决幻读（但一般不会用该隔离级别，而是在ii、iii隔离级别中利用灵活的方法加锁解决幻读）。
