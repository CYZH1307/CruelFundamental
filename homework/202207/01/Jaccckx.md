什么是MVCC Multi-Version Concurrent Control？

MVCC 多版本并发控制，就是同一份数据临时保存多版本的一种方式，实现并发控制。
InnoDB实现MVCC思路

InnoDB中有一个唯一的事务ID，为transaction id。在事务开始的时候，向InnoDB的事物系统中申请的，按照申请顺序严格递增的。

每行数据有多个版本，每次事务更新的时候，都会生成一个新的数据版本，并且将transaction id赋值给这个数据版本的事务ID，记为row trx_id。同时，旧的数据版本要保留，并且在新的数据版本中，能够有信息可以直接拿到。

数据表中的一行记录，可以有多个版本(row)，每个版本有自己的row trx_id。

同时生成每个版本的时候，会记录每一次的undo log回滚日志。

InnoDB为每个事务，构造了一个数组，用于保存这个事务启动的瞬间，正在活跃的所有事务ID，活跃为启动了但是还没提交的事务。

数组当中事务ID的最小值，即为低水位，当前系统里面已经创建的事务ID的最大值+1记为高水位。

这个视图数组和高水位，组成了当前事务的一致性视图。(read-view).

数据版本的可见性规则，基于数据的row trx_id和这个一致性视图对比结果得到。

对于当前事务的启动瞬间，一个数据版本的row trx_id，有以下几种可能：

1.如果落在已提交事务部分，表示这个版本为已经提交的事务，或者是当前事务自己生成的，这个数据为可见的。

2.如果落在未开始事务部分，表示这个版本为将来启动的事务生成的，肯定不可见。

3.如果落在未提交事务部分当中，有两种情况：

    (a)如果row trx_id在数组中，表示版本是由没有提交的事务，生成的不可见；
    (b)如果row trx_id不在数组中，表示这个版本为已经提交了的事务生成的，可见；
