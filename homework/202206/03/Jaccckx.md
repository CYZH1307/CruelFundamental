# 什么是缓冲区溢出？有什么危害？

我们先来看一段代码

```
void echo(){
	char buf[8];
	gets(buf);
}
```

汇编之后

```
echo:
	subq $24, %rsp
	movq %rsp, %rdi
	call gets
	addq $24, %rsp
	ret
```

我们观察到，系统为echo这个函数调用分配24字节的栈帧，故gets函数接受到不大于24字节字符串内容时，都能很好的存放在%rsp为起始地址的栈空间。但是因为gets函数没有限制接受字符串的大小，所以当字符串内容大于24字节时，将会对调用者栈帧造成破坏，这就是缓冲区溢出。

​	**对越界的数组元素的写操作会破坏存储在栈中的状态信息，当程序使用这个被破坏的状态，试图重新加载寄存器或执行ret指令时，就会出现严重的错误。会造成**

- 缓冲区溢出
- 让程序执行原本不愿执行的函数（大名顶顶的蠕虫病毒便是缓冲区攻击）

预防缓冲区攻击的方式有三种

- 栈随机化
- 栈破坏检测
- 限制可执行代码区域
