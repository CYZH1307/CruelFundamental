# 为什么要用B+树？

MySQL存储引擎Innodb选用B+树来存储数据。

可以从几个维度与其他数据类型对比，思考这个问题：查询速度、效率稳定性、存储数据大小、磁盘查找次数。



1、对比数据结构：哈希与树。

与哈希对比：如果使用哈希作为数据结构，当访问或修改一条数据的时候，可能哈希表的效率会更高，达到O(1)，而B+树访问或修改都是O(logn)。但是当遇到范围查询>、排序order by 等操作，哈希构成的索引性能会非常差，只能全表扫描。

- B+树可以范围查询、order by排序，Hash索引不行
- B+树支持联合索引最左匹配原则，Hash索引不行。
- Hash索引等值查询比B+树块。B+树可以使用like模糊查询，Hash索引不能模糊查询。

2、选择树的存储结构选型：B+树是从普通二叉树=>二叉查找树=>平衡二叉树=>B树=>B+树演化的过程。



（1）不选普通二叉树原因：普通二叉树变为链表，针对范围查询等都是全表扫描。

（2）不选二叉查找树：如果数据被存为一边倒的形式，也为链表，高度太高，查找效率不稳定。

（3）不选平衡二叉树：平衡二叉树，满足二叉查找树，又限制每个结点左右子树高度相差不大于1.保证了二叉查找树的高度。但是，当我们插入或删除数据，导致树不平衡，平衡二叉树会调整，维护一棵平衡二叉树的代价很高。并且每个结点只存储一个键值和数据，磁盘IO次数会很多，B树一个结点可以存储多个数据，树的高度降低，磁盘IO才能下降。适用于内存结构的对象，但不适用于磁盘存储。因此不选普通二叉树。

（4）不选B树：B树是为了解决平衡二叉树的维护弊端，单个结点可以存储多个键值和数据的平衡树。B树(balance tree)相对于平衡二叉树u，每个结点称为页，存储了更多的键值和数据，每个结点有更多子结点(阶)，B树查找数据读取磁盘次数会减小。但是因为数据仍然分散在各个结点，范围查找、排序查找也不容易。因此引入了B+树。

（5）选用B+树：

- B+树非叶子结点不存储数据，只存储键值。因此不存储数据，可以存储更多的键值，相应树的阶数也会更大，B+树比B树会更矮胖，进行磁盘IO次数减小，查询效率更快。
- B+树的数据存储出在叶子结点，并且数据按顺序排序，用双向链表相连，因此范围查找、排序查找、分组查询、去重查询等更高效。

