### tcp四次挥手过程？最后为什么等待2msls

#### tcp四次挥手过程

A状态：Established  B状态：Established

（1）A主动关闭，A发送FIN=1，seq=x报文 

A状态进入FIN-WAIT1 B收到第一次挥手的报文，回发送第二次握手进入状态CLOSE-WAIT关闭等待状态

（2）B收到第一次挥手后，B回发送 ACK=1 seq=y，ack=x+1。

A收到第二次挥手的报文进入FIN-WAIT-2状态，终止等待2，B还能够继续传输数据，仍然处于CLOSE-WAIT关闭等待状态。

（3）当B决定要终止报文发送，则会发送第三次挥手报文：FIN=1，ACK=1，seq=v，ack=x+1,。

B发送完第三次挥手报文进入LAST-ACK最后确认状态，等待A回发送第四次挥手。

（4）当A收到第三次挥手，发送第四次挥手报文：ACK=1，seq=x+1，ack=v+1。

第四次挥手发送后A进入TIME-WAIT时间等待状态等待2MSL报文长度，确保没有收到B的新的报文，来确保第四次挥手被B成功接收。



#### 最后为什么等待2msls

MSL是Maximum segment lifetime 报文最大生存时间。任何报文在网络上的最大存活时间，超过这个时间的报文将会被丢弃。设置2倍MSL，因为网络中可能存在来自发送方的数据包，这些数据包被接收方处理后会向发送方发响应需要2倍时间。

防止旧连接的数据包：2MSL能够让两个方向上的数据包都被丢弃，使得原来连接的数据包在网络中消失，新出现的数据包一定都是新建立连接产生的。

保证连接正确关闭：等待足够长的时间确保最后的ACK能够让被动关闭方接受，帮助其正常关闭。