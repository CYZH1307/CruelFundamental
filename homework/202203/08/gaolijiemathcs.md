## 请你说一下MySQL引擎的区别

MySQL为关系型数据库，关系型数据库存储以表形式存储。MySQL存储引擎有两个作用：（1）用于表的创建、数据存储、检索更新等（2）可以开发定制化存储引擎。

目前有多种存储引擎，MyISAM、InnoDB、Memory、Archive、NDB、Merge、Federated、Parter存储引擎等等。较为常见的为MyISAM、InnoDB、Memory，其中InnoDB为最常用的存储引擎。



### InnoDB

- 支持事务，保证一组数据库操作要么全部成功，要么全部失败。MyISAM不支持事务。
- 可以支持行级锁，为默认锁粒度。也支持表锁。
- 支持外键完整性约束，存储表中的数据，每张表的存储都按照主键顺序存放，如果没有显式在表定义的指定主键，InnoDB会为每行生成一个6字节的ROWID作为主键。外键会降低表查询速度，但是增加表之间耦合度。
- InnoDB不存表的总行数，如果执行count(*)需要将所有数据行取出来累积计数。而MyiSAM将表总行数单独存放，直接执行可以直接返回。但是加上where条件的时候，两者执行方式一样。
- InnoDB有redolog，与server层的binlog配合使用，可以支持崩溃恢复。MyISAM为原生的MySQL引擎，没有支持崩溃恢复。
- InnoDB中有缓冲管理，对于索引和数据可以缓冲起来，加快查询速度。InnoDB存储表和索引有两种方式，共享表空间存储，所有的表和索引都放在一个表空间。多表空间索引，表放在frm文件中数据索引放在ibd中。
- InnoDB类型表，数据物理组织形式为局促吧，数据按照主键组织，数据和索引放在一起，位于B+树的叶子结点上。



### MyISAM

- 不支持事务。
- 不支持崩溃恢复。
- 没有行级锁，并发度低，因为要锁就锁整张表，导致一有修改，整张表都不能动并发度低。
- 非聚集索引，使用B+树，但是索引和数据是分开的。MyISAM索引和数据是分开的，索引有压缩，内存使用率提高。每张MyISAM表会对应三个文件，.frm文件存储表定义的数据，.MYD文件具体存储记录数据。
- count(*)不加where限定条件，很快。如果加了与InnoDB一样走全表查询。
- NULL允许在索引列中。最大索引数为64，可以通过重新编译改变。每个索引最大列数为16。支持BLOB(存储二进制文件)或者TEXT(字符数据)列作为索引，可以存大文本。
- 有VARCHAR的表可以固定或动态记录长度，VARCHAR和CHAR列可以多达64KB。
- delete from table的时候，MyISAM会现将表结构备份到一个虚拟表中，然后执行drop，最后可以根据备份重建表。



### Memory

- 可以当做临时表直接存储在内存当中，适合数据量小的表。为了提高数据访问速度，每个表和一个磁盘frm文件关联。提供快速访问。
- 支持的数据类型有限，不支持BLOB或TEXT列。只支持固定长度的行。
- 只支持表级锁，访问量大的时候会成为瓶颈。
- 数据放在内存中，在Memory表和服务器查询处理空闲的时候，会创建内部表共享。但是服务器宕机，数据丢失。
- 不再需要Memory表内容，要释放memory表内存，执行delete from 或者truncate table 或者删除表drop table。
- 默认使用hash索引。



### 区别汇总

不同的存储引擎都有各自的特点，以适应不同的需求，如下表所示：

| **功 能**    | **InnoDB** | **MYISAM** | **Memory** | **Archive** |
| ------------ | ---------- | ---------- | ---------- | ----------- |
| 存储限制     | 64TB       | 256TB      | RAM        | None        |
| 支持事务     | Yes        | No         | No         | No          |
| 支持全文索引 | No         | Yes        | No         | No          |
| 支持数索引   | Yes        | Yes        | Yes        | No          |
| 支持哈希索引 | No         | No         | Yes        | No          |
| 支持数据缓存 | Yes        | No         | N/A        | No          |
| 支持外键     | Yes        | No         | No         | No          |

如果需要提供提交、回滚、崩溃恢复、事务安全(ACID)，实现并发控制，推荐选择InnoDB。

如果数据表主要是插入和查询，MyISAM提供较高效率。

如果临时存放数量不大，不需要较高数据安全性，可以将数据存在内存，使用Memory。MySQL使用该引擎作为临时表存储中间结果。

如果只有Insert和select可以选择Archive，支持高并发的插入操作，但是本身不是事务安全的。适合归档数据，记录日志等等。

一个数据库中的多个表可以选择不同引擎来满足各种性能和需求。





#### InnoDB和MyISAM区别

- InnoDB支持事务，MyISAM不支持事务
- InnoDB支持外键，MyISAM不支持外键
- InnoDB为聚集索引，B+TREE作为索引结构，数据文件和主键绑在一起。主键索引效率高，如果使用普通索引，需要回表，普通索引->主键->数据。主键不应该太大，主键大，其他索引的树也大。MyISAM非聚集索引，B+Tree索引结构，但是索引和数据分离，索引保存数据文件指针，主键索引和辅助索引独立。
- InnoDB不支持全文索引TEXT，MyISAM支持全文索引。MySQL5.7以后InnoDB也支持。
- InnoDB支持表级、行级锁(默认)，MyISAM只支持表级锁。
- InnoDB必须有主键(没有定义，默认加一列自增主键)，MyISAM可以没有主键。