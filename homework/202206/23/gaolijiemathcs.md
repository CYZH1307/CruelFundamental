### Java: 知道new一个对象的过程吗?

1、确认类元信息是否存在。当JVM接收到new指令时，首先在metaspace内检查需要创建的类元素是否存在。那么在双亲委派模式下，使用当前类加载器以ClassLoader+包名+类名为Key进行查找对应的class文件。如果没有找到文件，则抛出ClassNotFoundException异常，如果找到，则进行类加载（加载-验证-准备-解析-初始化），并且生成对应的Class类对象。

2、分配对象内存。首先计算对象占用空间大小，如果实例成员变量是引用变量，仅分配引用变量空间即可，4个字节大小，接着在堆中划分一块内存给新对象。在分配内存空间时，需要进行同步操作，比如采用CAS（Compare And Swap）失败重试、区域加锁等方式保证分配操作的原子性。

3、设定默认值。成员变量值都需要设定默认值，即各种不同形式的零值。

4、设置对象头。设置新对象的哈希码、GC信息、锁信息、对象所属的类元信息等。这个过程的具体设置方式取决于JVM实现。

5、执行init方式，初始化成员变量，执行实例化代码块，调用类的构造方法，并把堆内对象的首地址赋值给引用变量。