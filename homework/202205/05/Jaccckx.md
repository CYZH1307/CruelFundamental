# 消息积压 -- 一般处理方法



### 1. 是什么导致了消息积压？是consumer程序bug？是consumer消费的速度落后于消息生产的速度？

- 如果是消费者消费速度落后于消息生产者速度的话，可以考虑扩容消费者群组的方式

- 如果是消费程序bug

  - 积压比较严重，积压了上百万，上千万的消息

    - 修复现有consumer的问题，并将其停掉

    - 重新创建一个容量更大topic，比如patition是原来的十倍

    - 编写临时消费者程序

    - 将修复好的程序部署到原来十倍的机器上消费新队列

    - 消息积压解决后，恢复原有架构

      其实就是当下消息太多，且消费者程序出bug了。那就修复消费者程序，用大容量内存存储消息，并且在这个过程中用临时的消费者程序取代原有的，暂时消费消息（临时喊更多人干活）。把修复好的消费者提高性能，问题解决后使用原有架构

  - 如果消息已经丢失

    写个程序找到丢失的消息（一条条的查询），然后重新写到mq
