# 2PC

In order to ensure the atomicity of a transaction across multiple distributed nodes, we need every one to perform the same operation. If there is only one commit phase, it's possible that some of the nodes commit but some of the nodes don't, in this case, inconsistency happens.

Two-phase commit separates the process into two parts, in the prepare phase, after the coordinator writes data to all the participant nodes, it sends a prepare message to the nodes, and the participants will return "yes" if they are ok to commit or "no" if they are not. After getting the acknowledgements from all the nodes, the coordinator makes the decision: if all of the participants answer yes, then coordinator will decide to commit the transaction; if any of the participants answers no, then the transaction should be aborted. The coordinator sends the decision to all the nodes and they will follow. Here in all the nodes, the previous transaction data comes with the write ahead log, so they can easily undo the changes on abortion, or redo the changes if they receives the commit decision but fails to do so (e.g. due to server crash etc.)

Two-phase commit ensures the consistency and atomicity of a transaction if every nodes as well as the coordinator are working as expected; however, if the coordinator crashes, all the nodes will be blocked since they are waiting for the coordinator to make the decision.
