### 为什么 Linux 默认页大小是 4KB？什么是大页？什么情况适合用大页？

Linux 同时支持正常大小的内存页和大内存页（Huge Page）

绝大多数处理器上的内存页的默认大小都是 4KB，虽然部分处理器会使用 8KB、16KB 或者 64KB 作为默认的页面大小，但是 4KB 的页面仍然是操作系统默认内存页配置的主流。主要是历史考虑以下两个因素，4KB就长期留存下来了。

- 过小的页面大小会带来较大的页表项增加寻址时 TLB（Translation lookaside buffer）的查找速度和额外开销；
- 过大的页面大小会浪费内存空间，造成内存碎片，降低内存的利用率；



“大内存页”有助于 Linux 系统进行虚拟内存管理。除了标准的 4KB 大小的页面外，它们还能帮助管理内存中的巨大的页面，使用“大内存页”，你最大可以定义 1GB 的页面大小。

在虚拟内存管理中，内核维护一个将虚拟内存地址映射到物理地址的表，对于每个页面操作，内核都需要加载相关的映射。如果你的内存页很小，但是当运行内存需求量较大时，默认4KB大小的页面会导致较多的TLB miss和缺页中断，从而大大影响应用程序性能。使用大页以提高了内核级别的性能最终有利于应用程序的性能。

但是直接修改Linux内核页面大小，涉及面较广，不一定合适。为了以最小代价实现大页面支持，Linux采用了hugetlbfs特殊文件系统。这种文件系统形式支持大页面，使得应用程序可以根据需要灵活地选择虚拟内存页面大小。



ref:

https://www.cnblogs.com/yungyu16/p/13032962.html

https://www.cnblogs.com/arnoldlu/p/14028825.html
