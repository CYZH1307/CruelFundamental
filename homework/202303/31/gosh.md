TCP Keepalive和HTTP Keep-Alive是一个东西吗

应用层 / 应用层、表示层、会话层
HTTP/FTP/DNS/Telnet

传输层
TCP/UDP

网络层
IP

ARP
数据链路层
ARP

物理层

---------------------

TCP协议：面向连接的，可靠的，基于字节流的传输层通信协议。客户端和服务端在交换数据前，通过三次握手来简历TCP连接，建立连接后就可以进行基于字节流的双工通讯，通讯完成后通过四次挥手断开连接。

双方长时间未通讯时，如何得知对方还活着？如何得知这个TCP连接是健康且有通讯能力的？

TCP保活机制：keepalive
默认是关闭的，TCP连接的任何一方都可以打开此功能

三个主要配置参数：
如果在一段时间 （保活时间：tcp_keepalive_time）内，此连接都不活跃，开启保活功能的一段会向对端发送一个保活探测的报文。
	-若对端正常存活，切连接有效，对端能收到探测报文并进行相应。此时，发送端收到响应报文则证明TCP连接正常，重置保活时间计数器即可。
	-若由于网络原因或其他原因导致发送端无法正常收到保活探测报文的响应。那么在一定探测时间间隔（tcp_keepalive_intvl）后，将继续发送保活探测报文。直到收到对端的响应，或者达到配置的 探测循环次数上限（tcp_keepalive_probes）都没有收到对端响应，这时对端会被认为不可达，TCP连接已失效。此时要中断连接。


HTTP协议：
无状态的协议：永远都是客户端发起请求，服务器回送响应。每次连接只处理一个请求。当服务器返回本次请求的应答后便立即关闭连接，下次请求客户端再重新建立连接。
无状态导致客户端的每次请求都需要重新建立TCP连接，接收到服务端响应后，断开TCP连接。造成性能损耗。如何尽可能的减少性能损耗？

keep-alive机制：开启后，在一次http请求中，服务器进行响应后，不再直接断开TCP连接，而是将TCP连接维持一段时间。在这段时间内，如果同一个客户端再次向服务器发起http请求，便可以复用此TCP连接，向服务端发起请求，并重置timeout时间计数器，在接下来一段时间内还可以继续复用。

优缺点：
	-优点：避免了频繁建立和销毁连接的开销。减少服务端TIME_WAIT状态的TCP连接的数量（因为由服务端进程主动关闭连接）。
	-缺点：若keep-alive timeout设置的时间较长，长时间的TCP连接维持，会一定程度的浪费系统资源。
	