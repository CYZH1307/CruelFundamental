 ## traceroute是怎么traceback，最终让发出traceout的客户端得到信息的？

traceroute具体到实现细节上，有两种不同的方案：

### 基于UDP的实现

在基于UDP的视线中，客户端发送的数据包是通过UDP协议来传输的，使用了一个大于30000的端口号，服务器在收到这个数据包时会返回一个端口不可达的ICMP错误信息，客户端通过判断收到的错误信息是TTL超时还是端口不可达来判断数据包是否到达目标主机，具体流程如下：

1. 客户端发送一个TTL为1，端口号大于30000的UDP数据包，到达第一站路由器之后TTL被减去1，返回一个超时的ICMP数据包，客户端得到第一跳路由器的地址。
2. 客户端依次发送TTL加1的UDP数据包，返回一系列超时的ICMP数据包，分别得到路径上路由器的地址
3. 客户端发送的UPD数据包到达服务端，返回一个端口不可达错误，traceout结束。

### 基于ICMP的实现

相比于上述UDP的实现，这种实现中不使用UDP协议，而是直接发送一个ICMP回显请求数据包，服务器在收到回显请求后会向客户端发送一个ICMP回显应答数据包，之后流程都相似。

