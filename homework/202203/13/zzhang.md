### C++: constructor和desctructor能virtual吗

Reference: [zhihu](https://zhuanlan.zhihu.com/p/255274039)

1. 构造函数不可以是虚函数
   - 当类中声明虚函数时，编译器会在类中生成一个虚函数表，虚函数表是一个存储成员函数指针的数据结构
   - 虚函数表是由编译器自动生成与维护的，virtual成员函数会被编译器放入虚函数表中，当存在虚函数时，每个对象都有一个指向虚函数的指针（vptr指针）。在实现多态的过程中，父类和派生类都有vptr指针。
   - vptr的初始化：当对象在创建时，由编译器对vptr指针进行初始化。在定义子类对象时，vptr先指向父类的虚函数表，在父类构造完成之后，子类的vptr才指向自己的虚函数表
   - 如果构造函数时虚函数，那么调用构造函数就需要去找vptr，而此时vptr还没有初始化，因此构造函数不可以是虚函数
2. 析构函数常常是虚函数
   - 与构造函数不同，vptr已经完成初始化，析构函数可以声明为虚函数，且类有继承时，析构函数常常必须为虚函数
   - 若析构函数是虚函数，delete 时，基类和子类都会被释放；若析构函数不是虚函数，delete 时，只有基类会被释放，而子类没有释放，存在内存泄漏的隐患。
