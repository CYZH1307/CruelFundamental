## Linux 系统是如何收发网络包的？

Linux系统中的网络栈是一组处理网络通信的协议和组件，用于在网络上进行通信。当一个进程从网络上接收数据时，Linux系统会依次经过以下几个步骤：

1. 网卡收包：当网络接口接收到网络数据包时，网卡会将数据包拷贝到网卡缓冲区中，并通过中断或者轮询机制通知系统有新的数据包到来。
2. 硬件中断：当网卡有数据包到来时，会触发硬件中断，将CPU从用户态切换到内核态，并调用中断处理函数来处理网络数据包。
3. 协议栈处理：中断处理函数将数据包从网卡缓冲区中读取到内核缓冲区中，然后交给协议栈处理。协议栈包括网络驱动、协议层和套接字层等组件，用于将数据包进行分析、拆包、路由、协议处理等。
4. Socket缓冲区：在协议栈中，数据包会被复制到套接字缓冲区中，等待应用程序读取。
5. 应用程序读取：当应用程序调用read系统调用时，内核会将套接字缓冲区中的数据包拷贝到应用程序的缓冲区中，并通知应用程序数据已经准备好了。

当一个进程要发送数据包时，Linux系统会经过以下几个步骤：

1. 应用程序写入：当应用程序调用write系统调用时，数据包会被写入到应用程序的缓冲区中。
2. Socket缓冲区：内核会将数据包从应用程序的缓冲区中复制到套接字缓冲区中。
3. 协议栈处理：协议栈将数据包进行分析、拆包、路由、协议处理等。
4. 网卡发送：协议栈将数据包发送到网络接口，网卡将数据包发送到网络上。

总的来说，Linux系统中的网络栈是一个复杂的系统，它通过多个组件协同工作，实现了对网络通信的支持。在收发网络包时，需要经过多个步骤的处理和转换，以确保数据的正确性和可靠性。
