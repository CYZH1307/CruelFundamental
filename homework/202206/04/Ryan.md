# CPU负载和CPU利用率的区别是什么? 如果CPU负载很高，利用率却很低该怎么办? 如果负载很低，利用率却很高呢? 如果CPU使用率达到100%呢?怎么排查?

## 利用率
首先理解CPU在同一个核上是按照时分规则来实现多任务处理的，而时间的最小单位称为“时间片”，而利用率为给定一段时间内的 CPU时间片被程序使用的时间 / 总时间。
比如10个时间片内，程序A占用1个、程序B占用3个，则利用率为40%。

## 负载
CPU负载是给定一段时间内正在使用和等待使用CPU的平均任务数。将每个CPU核比作一个单次租住时间只能有一年，住宿时间超过一年就得重新排队的公寓。则负载为正在住和排队的人的总和。负载和利用率不是一个概念。
比如公寓A排队的是本地员工多，每人都能住满一年；公寓B排队的是外派员工多，每年只能住几个月。两个公寓排队一样长。则明显A和B的负载一样，但A的利用率明显高于B。

## 负载高、利用率低

说明处于等待状态的任务很多，而正在运行的任务有可能是僵死进程。通常这种情况是IO密集型的任务，大量任务在请求相同的IO，导致任务队列堆积。这时要重点排查磁盘I/O过高的情况、磁盘数据库应走却未走索引的情况、多进程死锁的情况。

## 负载低、利用率高

说明处于等待的任务数量正常，但某个或多个任务长时间占用计算资源。通常这种情况是程序本身触发了高复杂度的计算，需要排查自己写的程序是否时间复杂度过高。

## 排查CPU利用率100%

 - 通过top命令找到CPU占用率高的进程
 - 通过top -Hp pid命令查看CPU占比靠前的线程ID
 - 通过命令jstack配合线程ID找到出问题的代码
