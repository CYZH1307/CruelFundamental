### 什么是 TIME_WAIT 状态，为什么需要 TIME_WAIT 状态？时间是多久，为什么？

TIME_WAIT状态是主动发起关闭连接的一方，会存在TIME-WAIT状态，时长是2倍的MSL，MSL为报文最大生存时间，是任何报文在网络上存在的最长时间，2倍MSL正好是一来一回需要的时间。TIME_WAIT状态的作用是：

（1）防止具有相同的(TCP连接四元组)的旧数据包被客户端收到。由于网络延迟，服务端可能在第三次挥手的数据包存在旧包，这个时候相同的TCP端口连接被复用以后，为了防止旧包到达产生数据错乱的情况。因此TCP设计了2MSL的时间，足够让两个方向上的数据包都被丢弃，使得原来连接的数据包都在网络中消失，再出现的数据包都是新建立的连接产生的。

（2）保证连接正确关闭：TIME_WAIT等待足够长的时间，确保最后客户端发送的ACK可以被服务器端收到，从而帮助服务器端正常关闭。

- 如果服务器端正常收到四次挥手的最后一个ACK，服务器端正常关闭，不发包。
- 如果服务器端没有收到最后一个ACK保存，会重发第三次挥手的FIN保存，等待客户端最后ACK。

因此TIME-WAIT状态2MSL后，可以确保双方的连接都可以正常的关闭。

