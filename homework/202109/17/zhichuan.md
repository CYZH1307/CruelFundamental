# redlock

## bg

有N个redis master，他们互相独立，没有主从复制，也没有分布式协调机制

setnx将来会被弃用

## 操作

1. 获取当前的时间戳，毫秒
2. 依次从N个master中get相同的key，过期时间很小10几毫秒
3. 用当前的时间戳减去1中的时间戳，得到获取锁的时间。iff从大多数redis节点（N/2+1）中都能获取到锁，且时间小于失效时间的时候，才算成功
4. 真正有效时间=有效时间-3
5. 获取锁失败则在所有instance上解锁

## 实现

redission（弃用）

不是100%有效？