CPU分几级缓存，大小一般是多少。访问各级缓存需要的时间，需要多少CPU cycle的数量级。


- 三级缓存：L1，L2，L3
  - 对于CPU多核心的场景下，每个核心的L1,L2缓存都只能被这个核访问，别的核无法访问。L1，L2为该核的私有缓存。
  - L3缓存被以某种协议或者方式链接到CPU内的一种总线上，供所有核访问。L3为共享缓存
  - Intel Inclusive模式：L3的缓存包含了缓存所有内容，L2的内容是L3的子集，L1的内容是L2的子集。问题：空间浪费，缓存不一致问题，需要额外操作
  - AMD Exclusive模式：L1,L2,L3是一个大的整体，每一份数据是唯一的。问题：更改一份数据需要更多的操作。
- 存储类型：
  - 指令缓存：专门用来给CPU提供指令
  - 数据缓存：专门给CPU提供数据
  - 指令缓存与数据缓存的区别只会在L1存在，L2缓存是同时存储指令和数据的。
- 大小：
  - L1：最靠近CPU核，它的频率是与CPU核同频的，以Ghz为单位；容量比较小，一般情况下 几十kB至几百kB。[32KB data cache, 32KB instruction cache on my MBP]
  - L2：容量是 几百KB到几MB [256 KB per core on my MBP]
  - L3：十几MB。[6 MB on my MBP]



某处理器的CPU核访问三级缓存和内存需要占有的时钟周期与延迟

| 类型                     | 大约需要的CPU时钟周期 | 纳秒      |
| ------------------------ | --------------------- | --------- |
| 寄存器                   | 1                     |           |
| L1                       | 3-4                   | 1         |
| L2                       | 10                    | 3         |
| L3 （独享）              | 40-45                 | 15        |
| L3（与其他Core共享）     | 65                    | 19.5~34.8 |
| L3（其他Core正在修改L3） | 75                    | 22.5~40.2 |
| Memory                   |                       | 60        |

- 访问内存的时间是访问L1缓存的30-50倍。



Reference：https://zhuanlan.zhihu.com/p/353553358, https://itimetraveler.github.io/2018/09/09/CPU%20Cache%E4%B8%8E%E7%BC%93%E5%AD%98%E8%A1%8C/


