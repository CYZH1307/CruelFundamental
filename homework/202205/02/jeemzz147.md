### mysql如何保证主从数据一致
使用数据库中间件
* 所有的读写都走数据库中间件，通常情况下，写请求路由到主库，读请求路由到从库
* 记录所有路由到写库的key，在主从同步时间窗口内（假设是500ms），如果有读请求访问中间件，此时有可能从库还是旧数据，就把这个key上的读请求路由到主库
* 在主从同步时间过完后，对应key的读请求继续路由到从库
* 常用的数据库中间件：canal、otter等


缓存记录写key法

* 如果key要发生写操作，记录在cache里，并根据经验设置的cache超时时间，例如500ms
然后修改主数据库
* 先到缓存里查看，对应key有没有相关数据
有相关数据，说明缓存命中，这个key刚发生过写操作，此时需要将请求路由到主库读最新的数据
如果缓存没有命中，说明这个key上近期没有发生过写操作，此时将请求路由到从库，继续读写分离

优点：

相对数据库中间件，实现成本较低

缺点：

为了保证“一致性”，引入了一个cache组件，并且读写数据库时都多了缓存操作
