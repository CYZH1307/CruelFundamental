# TCP 三次握手



简述TCP三次握手过程。



第一次握手：客户端发送 `SYN` 报文，进入 `SYN_SENT` 状态，等待服务器确认

第二次握手：服务器收到 `SYN` 报文，给客户端发送 `ACK` 确认报文 和  `SYN` 报文，进入 `SYN_RCVD` 状态

第三次握手：客户端收到 `ACK` + `SYN` 报文，向服务器发送 `ACK` 报文，进入 `ESTABLISHED`状态；服务器收到客户端的 `ACK`报文，也进入`ESTABLISHED` 状态，完成三次握手。



为什么TCP握手需要三次，两次行不行？



TCP三次握手是为了 

- 确认双方的收发能力
- 序列号可靠同步：若两次握手，服务器无法确定客户端是否接收到自己发送的初始序列号

- 阻止重复历史连接的初始化：如果客户端不小心发了两个不同序号的`SYN`包，若两次握手，服务器收到旧的`SYN`就建立连接，会发生异常；若三次握手，服务器回复`SYN`和`ACK`包，客户端对比应答的序列，如果发现是旧的报文，会要求重发。
- 基于安全的考虑：TCP连接时会分配资源，若两次握手就建立连接，放大DDoS攻击。
