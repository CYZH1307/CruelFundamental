# 微博限定用户每次输入最多 140 个字符，用户如果传字符串很长的链接，怎么办

使用短链接, 将长连接映射为短链接. 然后访问短链接的时候, 通过重定向转入长连接. 


长短连接的映射关系需要数据库进行存储, 否则系统重启就要重新映射, 那么之前发放的短链接都失效了. 

其次的问题是如何高效的进行长短连接的映射呢. 可以使用相同的前缀, 而分发唯一的ID进行区别. 比如生成短链接形如: `abcd.com/id`. 这样只要对一个长连接分发一个ID就行了.

为了保证高效的查找长链接对应的ID, 需要内存数据库如`redis`进行缓存. 可以将最近/最热门的长连接-ID映射关系存储在K-V内存数据库中. ID的存储可以使用10进制. 而将其转换为高进制(如32进制)后进行发放. 这样可以避免太过规律.

分布式处理的时候可以采用**雪花算法**生成分布式自增ID. 也可以采用分组发放的思路, 即每个节点发放固定间隔的数. 比如1号节点发放[1, 101, 201, 301...], 2号节点发放[2, 102, 202, 302...], 100号节点发放[100, 200, 300...].