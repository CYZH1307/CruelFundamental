### 说下浏览器请求一个网址的过程?

### 简答：

```
1.DNS解析URL域名得到对应的IP地址
2.根据IP地址与服务器三次握手建立TCP连接(每次建立连接需要从HTTP-TCP-IP-网关以太网头部包装) 建立TCP连接
3.建立连接后，浏览器从第三次握手开始传输请求数据的HTTP报文
4.服务器响应浏览器请求，对应的HTML文本发送给浏览器。
5.浏览器显示数据
6.四次挥手释放TCP
```

### 展开过程：

Step1：浏览器解析URL：浏览器确定Web服务器和文件路径。

```
URL元素组成:
	http://www.baidu.com/
	[URL访问协议] + // + [Web服务器] + [数据源文件的路径名称(可选)]
如果数据源文件路径名称没有，则访问根目录下的默认文件， /index.html 或 /default.html
```

Step2：生产HTTP请求信息

Step3：DNS查询真实地址：查询服务器域名对应的IP地址。

```
DNS服务器用于专门保存Web服务器域名与IP的对应关系的服务器。DNS中域名都是句点分割代表不同级别边界，越靠右层级越高。
根域名最顶层，下一层为com定级域名，在线为xxx.com域名。【根DNS服务器】【顶级域名DNS服务器(.com/.cn/....)】【权威DNS服务器(xxx.com/yyy.cn/...)】
因此客户端可以找到任意一台DNS服务器，然后找到根域DNS服务器，再找到位于下层的某台目标DNS服务器。
```

```
DNS域名解析过程
(1)【客户端】发出一个DNS请求，问www.xxx.com的IP 发送给【本地DNS域名服务器】
(2)【本地DNS域名服务器】收到客户端请求，查本地缓存，有则返回，没有则问根服务器，【根DNS服务器】不直接解析，但是指明一个【.com 顶级域名服务器】
(3)【本地DNS域名服务器】询问指明的【xxx.com的权威DNS服务器地址】
(4)【xxx.com的权威DNS服务器地址】为域名解析结果出处。给出对应的IP地址x.x.x.x给【本地DNS域名服务器】
(5)【本地DNS域名服务器】将IP地址返回【客户端】
```

Step4: HTTP传输工作交给操作系统中的协议栈

```
应用程序:网络应用程序(浏览器、web服务器)【Socket库】
--------------------------------------------
操作系统:协议栈【TCP/UDP】【IP、ICMP、ARP 传送网络包、确定路由】
--------------------------------------------
驱动程序:网卡驱动程序(控制网卡)
--------------------------------------------
硬件:物理硬件网卡
```

```
(1)应用层：程序调用Socket库，委托下层协议栈工作。
(2)操作系统协议栈：TCP/UDP负责接收应用层的委托完成收发数据的操作。IP协议控制网络包收发操作。ICMP告知网络包传输过程中产生的错误与控制信息。ARP查询IP对应的以太网MAC地址。
(3)网卡驱动程序：控制网卡硬件
(4)硬件网卡：完成实际收发操作
```

```
应用程序生成HTTP报文->加上TCP头部->加上IP头部->ARP协议缓存/广播找路由器MAC->加上MAC头部->得到网络包通过网卡将数字信息转换为电信号

HTTP基于TCP协议加上TCP头部传输，先三次握手连接、收发、四次挥手断开。
IP协议将数据封装完为网络包发送给通信对象。加上IP报文头部。
通过ARP协议查看ARP缓存，没有则广播，找到路由器MAC。加上MAC头部。得到网络包
网卡驱动将网络包复制到网卡缓存区，加上报文头与起始帧分界符，末尾错误校验序列。
网卡将网络包转为电信号发送。
```

Step5：交换机/路由器转发

(1)交换机转发

交换机将网络包原样转发到目的端口。交换机根据MAC地址表查找MAC地址，电信号送到对应的端口。如果MAC地址表没有MAC地址，无法判断，则只会转发到除了源端口之外的所有端口上。到达目的地之后，会有响应包，这个时候交换机会将包中的信息写入MAC地址表。

交换机为二层网络设备，端口不具有MAC地址，基于以太网设计。FCS错误校验。

(2)路由器转发

路由器基于IP设计三层网络设备，路由器各个端口有MAC地址和IP地址。路由表查询转发目标，再由对应的端口作为发送包发送。

路由器包接收->查询路由表确定出口方向->路由发送

```
接包的过程线FCS错误校验，检查接收方MAC地址，是给自己的就缓存，否则就查询路由表准备转发。
查询的过程，路由会找子网掩码做&与运算，对目标地址进行匹配，匹配则作为候选转发目标。找不到则发默认路由。
发送过程：根据路由表判断对方地址，看是否达到终点。
源IP与目标IP不变，不断变化MAC地址，使得在两个设备之间传输。
```

Step6:服务器端到达开始层层拆包获得传输的http数据

````
以太网头部-ip头部-tcp头部-http数据
````

