### C++: 简述 vtable

------

一般C++编译器通过虚函数表实现虚函数这一概念，有虚函数存在的类中，会有一个虚表指针，指向存有虚函数的表（也可以理解为一个指针数组），程序访问调用虚函数时，通过虚表指针和偏移量（函数名在对应抽象类的虚表中有固定偏移量）即可访问到对应的虚函数。 （注：通过虚表实现虚函数自然只是虚函数实现的一种方式）

同时，虚表第一项一般存有指向类型信息的指针，即能反应拥有指向该虚表的虚指针的实例的具体类型信息，用来实现RTTI（Run Time Type Identification）这一机制，也是C++实现多态机制的一部分。

虚表中除了存有指向虚函数的指针外，可能还存有指向一段间接调用虚函数代码（thunk code）的指针，它会进行偏移this指针等操作，主要是为了解决多继承中调用子类虚函数this指针并未指向该子类的问题。

每一个类的虚表在编译阶段就能确定里面的内容，因此虚表内容一般存在程序的全局数据区（或者.rodata只读段等类似段中）。