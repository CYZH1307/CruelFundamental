短链是通过服务器重定向到原始链接实现的.

原理就是通过发号策略，给每一个过来的长地址，发一个号即可，小型系统直接用mysql的自增索引就搞定了。如果是大型应用，可以考虑各种分布式key-value系统做发号器。不停的自增就行了。

第一个使用这个服务的人得到的短地址是[http://xx.xx/0](https://link.zhihu.com/?target=http%3A//xx.xx/0) 第二个是 [http://xx.xx/1](https://link.zhihu.com/?target=http%3A//xx.xx/1) 第11个是 [http://xx.xx/a](https://link.zhihu.com/?target=http%3A//xx.xx/a) 第依次往后，相当于实现了一个62进制的自增字段即可。

62进制如何用数据库或者KV存储来做？其实我们并不需要在存储中用62进制，用10进制就好了。比如第10000个长地址，我们给它的短地址对应的编号是9999，我们通过存储自增拿到9999后，再做一个10进制到62进制的转换，转成62进制数即可。

*如何保证同一个长地址，每次转出来都是一样的短地址* 上面的发号原理中，是不判断长地址是否已经转过的。也就是说用拿着百度首页地址来转，我给一个[http://xx.xx/abc](https://link.zhihu.com/?target=http%3A//xx.xx/abc) 过一段时间你再来转，我还会给你一个 [http://xx.xx/xyz](https://link.zhihu.com/?target=http%3A//xx.xx/xyz)。这看起来挺不好的，但是不好在哪里呢？不好在不是一一对应，而一长对多短。

那么如何解决？用key-value存储，保存“最近”生成的长对短的一个对应关系。注意是“最近”，也就是说，我并不保存全量的长对短的关系，而只保存最近的。比如采用一小时过期的机制来实现LRU淘汰。

这样的话，长转短的流程变成这样： 1 在这个“最近”表中查看一下，看长地址有没有对应的短地址 1.1 有就直接返回，并且将这个key-value对的过期时间再延长成一小时 1.2 如果没有，就通过发号器生成一个短地址，并且将这个“最近”表中，过期时间为1小时

所以当一个地址被频繁使用，那么它会一直在这个key-value表中，总能返回当初生成那个短地址，不会出现重复的问题。如果它使用并不频繁，那么长对短的key会过期，LRU机制自动就会淘汰掉它。

*如何保证[发号器](https://www.zhihu.com/search?q=发号器&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A46446911})的大并发高可用* 上面设计看起来有一个单点，那就是发号器。如果做成分布式的，那么多节点要保持同步加1，多点同时写入，这个嘛，以CAP理论看，是不可能真正做到的。其实这个问题的解决非常简单，我们可以退一步考虑，我们是否可以实现两个发号器，一个发单号，一个发双号，这样就变单点为多点了？依次类推，我们可以实现1000个逻辑发号器，分别发尾号为0到999的号。每发一个号，每个发号器加1000，而不是加1。这些发号器独立工作，互不干扰即可。而且在实现上，也可以先是逻辑的，真的压力变大了，再拆分成独立的物理机器单元。

*跳转用301还是302* 这也是一个有意思的话题。首先当然考察一个候选人对301和302的理解。[浏览器](https://www.zhihu.com/search?q=浏览器&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A46446911})缓存机制的理解。然后是考察他的业务经验。301是永久重定向，302是临时重定向。短地址一经生成就不会变化，所以用301是符合http语义的。同时对服务器压力也会有一定减少。 但是如果使用了301，我们就无法统计到短地址被点击的次数了。而这个点击次数是一个非常有意思的[大数据](https://www.zhihu.com/search?q=大数据&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={"sourceType"%3A"answer"%2C"sourceId"%3A46446911})分析数据源。能够分析出的东西非常非常多。所以选择302虽然会增加服务器压力，但是我想是一个更好的选择。



https://www.zhihu.com/question/29270034







