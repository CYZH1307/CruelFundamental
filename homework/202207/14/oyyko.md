SDS有什么好处呢？

## **常数复杂度获取长度**

我们都知道，strlen获取**C传统字符串长度的时间复杂度为O(N)**，而上面的结构中，获取字符串长度的**时间复杂度为常数**，因为len字段存储了字符串的长度，这样的做法虽然多占用了一点空间，换来的却是效率的提升。

## **预分配空间减少内存分配次数**

实际上，在创建新的sds的时候，它并不仅仅申请要使用的内存，而是额外申请了一些空间，以避免下次修改的时候又需要重新申请内存。

什么意思呢？

比如说，你有一个字符数组：

```javascript
char str[] = "hello";
```

复制

现在你想存储helloworld，怎么办？原先的空间已经确定了，没有办法存储这么多字符串，你只能重新申请空间，然后还要把原先的hello拷贝到新申请的空间中去。如果有频繁地修改字符串，就会导致系统中频繁的内存申请，释放，拷贝，这样还能有高效的redis吗？

因此在redis中，如果有这样的情况，分配新的空间的时候，**会预分配一些空间，以备下次使用**。

## **惰性释放空间**

而正因如此，出现字符串缩短的时候，也没有必要直接释放内存，只需要更新字符串，记录当前使用的长度即可，你说，下次字符串又增长的时候，不就又用上了吗？



## **保存二进制数据**

看下面的字符串：

```javascript
char str[] = "hello\0world";
```

复制

你说下面的字符串，strle长度是多少？不是10，也不是11，而是5。为啥？遇到\0就计算结束了呗。所以要想存储一些特殊的字符串，即中间可能出现\0的字符串，传统的C字符串还不好办呢。

sds就不一样了，管你存什么，反正我长度是记录在len字段中了，输入写入多少，我记录多少。因此它可以保存二进制数据。