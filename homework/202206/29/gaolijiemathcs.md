### 什么是CAS (compare and swap)操作? 它的作用是什么？它是如何在硬件上实现的？ 什么是ABA问题?

#### 什么是CAS (compare and swap)操作? 它的作用是什么？

CAS操作，比较并交换是原子操作的一种，可以在多线程编程中实现不被打断的数据交换操作，避免多线程同时改写某一数据时由于执行顺序不确定性以及中断的不可预知性，产生的数据不一致的问题。该操作通过将内存中的值与指定数据进行比较，当数值一样时将内存中的数据替换为新的值。

#### CAS如何在硬件上实现？

CAS操作基于CPU提供的原子操作指令实现，Intel x86处理器，**可以通过汇编指令前增加LOCK前缀来锁定系统总线，使系统总线在汇编指令执行时无法访问相应的内存地址，而各个编译器根据这个特点实现了各自的原子操作函数。**

#### 什么是ABA问题？

进程1读取了数据A，进程1被挂起（中断/时间片耗尽）以后，进程2先修改A为B再从B修改为A。进程1被唤醒以后，发现数值A没有变化，因此程序继续执行。

线程1对于这个数值A认为没有改变，但是实际上改变了，由于CAS中多为指针，所指向地址的值可能变化，而感受不到，因此存在ABA问题。

解决方法：可以加个版本号。控制修改的版本，可以辨别ABA中不同A之间的区别。