TCP如何保证包的有序传输

发送主机每次发送数据时，TCP就给每个数据包分配一个序列号并且在一个特定的时间内等待接收主机对分配的这个序列号进行确认，

如果发送主机在一个特定时间内没有收到接收主机的确认，则发送主机会重传此数据包。

接收主机利用序列号对接收的数据进行确认，以便检测对方发送的数据是否有丢失或者乱序等，接收主机一旦收到已经顺序化的数据，它就将这些数据按正确的顺序重组成数据流并传递到高层进行处理。



TIME_WAIT:



主动关闭方在收到被动关闭方的`FIN`包后并返回`ACK`后，会进入`TIME_WAIT`状态，`TIME_WAIT`状态又称`2MSL`状态，每个TCP连接都必须有一个最大报文段生存时间MSL，在网络传输中超过这个时间的报文段将被丢弃。当TCP连接发起一个主动关闭，并发出最后一个ACK时，必须在`TIME_WAIT`状态停留两倍MSL时间，在`2MSL`等待期间，定义这个连接的插口(客户端IP地址和端口号，服务器IP地址和端口号的四元组)将不能再被使用。`2MSL`状态存在有两个理由：



- **1.允许老的重复报文分组在网络中消逝。**
- **2.保证TCP全双工连接的正确关闭。**



### **为什么是维持2MSL**

- 一个`MSL`是确保主动关闭方最后的`ACK`能够到达对端。
- 一个`MSL`是确保被动关闭方重发的`FIN`能够被主动关闭方收到。





https://zhuanlan.zhihu.com/p/99943313



https://draveness.me/whys-the-design-tcp-time-wait/