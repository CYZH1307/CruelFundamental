### SYN攻击

SYN洪泛攻击的基础是依靠TCP建立连接三次握手的机制

#### 前置知识

**SYN-ACK重传次数**：服务器发送完SYN-ACK包之后，如果未收到客户确认包，服务器进行首次重传，等待一段时间之后仍未收到客户确认包，进行第二次重传，重传次数超过系统规定的最大重传次数，系统将改连接信息从半连接队列中删除，每一次重传等待时间不一定。

**半连接存活时间**：指半连接队列的条目存活的最长时间， 也就是server从收到SYN 到 确认这个报文无效的最长时间，该时间值时所有重传请求包的最长等待时间的总和，也称为Timeout 时间，SYN_RECV存活时间。

#### SYN攻击原理

客户端在短时间内伪造大量不存在的IP地址，向服务器不断地发送syn包，服务器回复确认包，并等待客户端确认，由于源地址不存在，服务器需要不断的重发直至超时，那些伪造的SYN包将占用大量资源，在正常的SYN请求被丢弃，目标系统远行缓慢。

#### SYN攻击防范技术

SYN攻击防范技术有两大类，一类是通过防火墙，路由器等过滤网关防护，另一类是通过加固TCP/IP 协议栈防范，但是SYN攻击不能被完全组止，只能尽可能的减轻SYN攻击的危害

##### 1，过滤网关防护

- 网关超时设置：
  当服务器发完 SYN + ACK 后吗，防火墙在计数器到期时还未收到客户的ACK，则往服务器发送RST包，使服务器丢弃该半连接，该参数过小会影响正常通信，过大又影响防范SYN攻击的效果

- SYN网关：

  SYN网关当收到SYN后直接转发给服务器，SYN网关收到SYN + ACK后将包转发给客户端，同时以客户端的名义给服务器发送ACK，服务器的半连接状态进入连接状态，当客户端确认包到达后，有数据则转发，没有就丢弃，该方法能有效缓解半连接队列的压力

- SYN代理：
  当收到SYN后，SYN代理并不转发SYN包，而是以服务器的名义回复SYN + ACK给客户，如果收到客户ACK，防火墙就发送ACK包完成三次握手，SYN代理就是真的”代理“呗，代替服务器接受SYN攻击，要求过滤网关有很强的防范SYN攻击能力

##### 2，加固TCP/IP协议栈

防范SYN攻击的技术还有就是调整TCP/IP协议栈，修改tcp协议实现，主要方法有SynAttackProtect保护机制，SYN cookies技术，增加最大半连接和缩短超时时间等

