### 事务消息是否了解？场景题：比如下单清空购物车，你是如何设计？


订单系统创建完订单后，然后发消息给下游系统购物车系统，清空购物车。

* 生产者（订单系统）产生消息，发送一条半事务消息到MQ服务器
* MQ收到消息后，将消息持久化到存储系统，这条消息的状态是待发送状态。
* MQ服务器返回ACK确认到生产者，此时MQ不会触发消息推送事件
* 生产者执行本地事务（订单创建成功，提交事务消息）
* 如果本地事务执行成功，即commit执行结果到MQ服务器；如果执行失败，发送rollback。
* 如果是commit正常提交，MQ服务器更新消息状态为可发送；如果是rollback，即删除消息。
* 如果消息状态更新为可发送，则MQ服务器会push消息给消费者（购物车系统）。消费者消费完（即拿到订单消息，清空购物车成功）就应答ACK。
* 如果MQ服务器长时间没有收到生产者的commit或者rollback，它会反查生产者，然后根据查询到的结果（回滚操作或者重新发送消息）执行最终状态。
